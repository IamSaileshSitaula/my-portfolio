<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Storage Decision Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Harmony -->
    <!-- Application Structure Plan: The SPA is designed as a four-part, task-oriented dashboard to guide a supply chain manager from a high-level overview to actionable insights. It starts with a 'Dashboard' for key takeaways, moves to a 'Commodity Explorer' for deep-diving into individual items, then explains the 'Model Framework' for transparency, and concludes with an 'Interactive Recommendations' section. This non-linear, user-centric structure is superior to the report's linear format because it allows decision-makers to quickly grasp the essentials, explore data based on their own questions, and tailor the final recommendations to their specific strategic priorities (e.g., profit vs. turnover), making the tool both faster and more flexible for its intended business purpose. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Commodity characteristics (price, shelf life, volatility). Goal: Compare & explore relationships. Viz/Presentation: Interactive Scatter Plot (Volatility vs. Shelf Life) linked to a sortable HTML Table. Interaction: Hover/click points on the chart to highlight the corresponding row in the table and update a detailed view card. Justification: This visualizes the critical trade-off between risk (volatility) and storage constraint (shelf life) discussed in the report, allowing users to identify strategic groups (e.g., high volatility, short shelf-life) and drill down for details. Library/Method: Chart.js for the scatter plot, Vanilla JS for the interactive linking and table sorting.
        - Report Info: MCDM ranking results and operational KPIs. Goal: Provide customizable, actionable recommendations. Viz/Presentation: Interactive HTML Table with sliders for weighting criteria. Interaction: Users drag sliders to adjust the importance of 'Profitability', 'Turnover Speed', and 'Storage Efficiency'. The table of recommended commodities re-ranks in real-time. Justification: This transforms the static recommendation table from the report into a dynamic decision-support tool, empowering managers to perform sensitivity analysis and align the model's output with their specific, and potentially changing, business goals. Library/Method: Vanilla JS for the weighting calculation and DOM manipulation.
        - Report Info: Price history and trends. Goal: Show historical price behavior for a selected commodity. Viz/Presentation: Line chart. Interaction: Chart updates when a new commodity is selected in the 'Commodity Explorer'. Justification: Provides necessary context for why a certain commodity might be volatile or trend-following. Library/Method: Chart.js.
        - Report Info: Model methodology (ARIMA, Simulation). Goal: Build trust and explain the process. Viz/Presentation: A structured HTML/CSS flow diagram. Interaction: Hovering over steps reveals more detail. Justification: Demystifies the complex model described in the report in an easily digestible, non-technical format. Library/Method: HTML/CSS with Tailwind.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 50vh; }
        @media (min-width: 768px) { .chart-container { height: 450px; } }
        .nav-link { transition: all 0.3s ease; }
        .nav-link.active { color: #84cc16; border-bottom-color: #84cc16; }
        .nav-link:not(.active) { border-bottom-color: transparent; }
        .table-sortable th:hover { cursor: pointer; background-color: #f9fafb; }
        .table-sortable th.sorted-asc::after { content: ' ‚ñ≤'; }
        .table-sortable th.sorted-desc::after { content: ' ‚ñº'; }
        html { scroll-behavior: smooth; }
        .section-fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .section-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-30 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-2xl font-bold text-slate-900">
                        <span class="text-lime-600">üìà</span> Cold Storage Analytics
                    </h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#dashboard" class="nav-link text-slate-600 hover:text-lime-600 px-3 py-2 text-sm font-medium border-b-2">Dashboard</a>
                        <a href="#explorer" class="nav-link text-slate-600 hover:text-lime-600 px-3 py-2 text-sm font-medium border-b-2">Commodity Explorer</a>
                        <a href="#framework" class="nav-link text-slate-600 hover:text-lime-600 px-3 py-2 text-sm font-medium border-b-2">Model Framework</a>
                        <a href="#recommendations" class="nav-link text-slate-600 hover:text-lime-600 px-3 py-2 text-sm font-medium border-b-2">Recommendations</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <section id="dashboard" class="scroll-mt-20 section-fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Decision Support Dashboard</h2>
                <p class="text-slate-600 max-w-4xl">This dashboard translates the complex findings of the "Optimizing Cold Storage Commodity Resale" report into an interactive tool. Its purpose is to help supply chain managers identify commodities with the highest potential for profitable resale by analyzing historical price data against shelf-life constraints, ultimately aiming to improve ROI and reduce waste.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-sm font-medium text-slate-500">Most Profitable (Simulated)</h3>
                    <p id="top-profitable" class="mt-1 text-3xl font-semibold text-lime-600">Potato Red</p>
                    <p class="text-sm text-slate-500">Highest avg. profit per trade</p>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-sm font-medium text-slate-500">Fastest Turnover</h3>
                    <p id="top-turnover" class="mt-1 text-3xl font-semibold text-amber-600">Tomato Big(Nepali)</p>
                     <p class="text-sm text-slate-500">Shortest avg. holding duration</p>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-sm font-medium text-slate-500">Highest Storage Efficiency</h3>
                    <p id="top-efficiency" class="mt-1 text-3xl font-semibold text-sky-600">Chilli Dry</p>
                    <p class="text-sm text-slate-500">Highest simulated profit per volume unit</p>
                </div>
            </div>
             <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                <h3 class="text-xl font-bold text-slate-900 mb-4">Commodity Shelf-Life Distribution</h3>
                <p class="text-slate-600 mb-4 max-w-4xl">Commodities are grouped into strategic categories based on their minimum shelf life. This fundamental characteristic dictates the time window available for price appreciation and heavily influences the feasibility of a storage-and-resale strategy. Short-life items demand rapid, predictable price movements, while long-life items allow for capitalizing on broader trends.</p>
                <div class="chart-container h-[300px] md:h-[350px]">
                    <canvas id="shelfLifeChart"></canvas>
                </div>
            </div>
        </section>
        
        <div class="my-12 border-t border-slate-200"></div>

        <section id="explorer" class="scroll-mt-20 section-fade-in">
             <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Commodity Explorer</h2>
                <p class="text-slate-600 max-w-4xl">This section allows for an in-depth exploration of individual commodities. The chart below plots each commodity's price volatility against its minimum shelf life, revealing the fundamental risk-reward landscape. High volatility offers profit potential but is risky for items with a short shelf life. Use the chart and table to select commodities and view their detailed price history and key metrics.</p>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
                <h3 class="text-xl font-bold text-slate-900 mb-4">Volatility vs. Shelf Life</h3>
                <div class="chart-container">
                    <canvas id="volatilityChart"></canvas>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6 md:p-8">
                    <div class="flex flex-wrap items-center justify-between mb-4 gap-4">
                        <h3 class="text-xl font-bold text-slate-900">Commodity Data</h3>
                        <input type="text" id="commodity-filter" placeholder="üîé Filter by name..." class="w-full sm:w-64 px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-lime-500">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-500 table-sortable">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3" data-sort="name">Commodity</th>
                                    <th scope="col" class="px-6 py-3" data-sort="minShelfLife">Min Shelf Life (Days)</th>
                                    <th scope="col" class="px-6 py-3" data-sort="avgPrice">Avg. Price (NPR)</th>
                                    <th scope="col" class="px-6 py-3" data-sort="volatility">Volatility (Annualized)</th>
                                    <th scope="col" class="px-6 py-3" data-sort="unit">Unit</th>
                                </tr>
                            </thead>
                            <tbody id="commodity-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                     <h3 class="text-xl font-bold text-slate-900 mb-4">Price History</h3>
                     <p id="price-chart-commodity-name" class="text-lg font-semibold text-lime-600 mb-2">Select a commodity</p>
                    <div class="chart-container h-[300px]">
                        <canvas id="priceHistoryChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <div class="my-12 border-t border-slate-200"></div>

        <section id="framework" class="scroll-mt-20 section-fade-in">
             <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Model Framework</h2>
                <p class="text-slate-600 max-w-4xl">The recommendation engine follows a systematic, multi-stage process to transform raw historical data into actionable insights. This framework ensures that commodity rankings are based on a holistic assessment of price predictability, simulated profitability, and operational feasibility, all while strictly adhering to shelf-life constraints. Hover over each step to learn more.</p>
            </div>
            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 text-center">
                 <div class="group flex-1 bg-white p-4 rounded-xl shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="text-4xl">üìä</div>
                    <h4 class="font-bold mt-2">1. Data Analysis</h4>
                    <p class="text-sm text-slate-500 mt-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity duration-300">Analyze historical price trends, volatility, and shelf-life data for each commodity to establish a baseline profile.</p>
                </div>
                <div class="text-2xl hidden md:flex items-center text-slate-300">‚Üí</div>
                <div class="group flex-1 bg-white p-4 rounded-xl shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="text-4xl">üîÆ</div>
                    <h4 class="font-bold mt-2">2. Price Forecasting</h4>
                    <p class="text-sm text-slate-500 mt-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity duration-300">Use ARIMA time-series models to forecast future price movements based on past patterns, a key input for the simulation.</p>
                </div>
                <div class="text-2xl hidden md:flex items-center text-slate-300">‚Üí</div>
                <div class="group flex-1 bg-white p-4 rounded-xl shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="text-4xl">‚öôÔ∏è</div>
                    <h4 class="font-bold mt-2">3. Strategy Simulation</h4>
                    <p class="text-sm text-slate-500 mt-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity duration-300">Simulate buying and selling based on defined strategies (e.g., trend following, profit targets), enforcing shelf-life expiry as a hard constraint.</p>
                </div>
                <div class="text-2xl hidden md:flex items-center text-slate-300">‚Üí</div>
                <div class="group flex-1 bg-white p-4 rounded-xl shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
                    <div class="text-4xl">üèÜ</div>
                    <h4 class="font-bold mt-2">4. Weighted Ranking</h4>
                    <p class="text-sm text-slate-500 mt-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity duration-300">Rank commodities using a multi-criteria model that scores them on profit, turnover speed, and storage efficiency to produce final recommendations.</p>
                </div>
            </div>
        </section>

        <div class="my-12 border-t border-slate-200"></div>

        <section id="recommendations" class="scroll-mt-20 section-fade-in">
             <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Interactive Recommendations</h2>
                <p class="text-slate-600 max-w-4xl">This is the core output of the decision-support model. The table below ranks commodities based on their overall suitability for a buy-store-resell strategy. **Use the sliders to adjust the weights** of different business priorities. This will dynamically recalculate the scores and re-rank the commodities, allowing you to tailor the recommendations to your specific goals, whether it's maximizing raw profit, ensuring fast turnover, or optimizing storage space.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6 md:p-8 h-fit">
                    <h3 class="text-xl font-bold text-slate-900 mb-6">Adjust Your Priorities</h3>
                    <div class="space-y-6">
                        <div>
                            <label for="profit-weight" class="block text-sm font-medium text-slate-700">Profitability Focus</label>
                            <input id="profit-weight" type="range" min="0" max="100" value="40" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" style="accent-color: #84cc16;">
                            <span class="text-xs text-slate-500">How important is maximizing profit per trade?</span>
                        </div>
                         <div>
                            <label for="turnover-weight" class="block text-sm font-medium text-slate-700">Turnover Speed</label>
                            <input id="turnover-weight" type="range" min="0" max="100" value="30" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" style="accent-color: #f59e0b;">
                             <span class="text-xs text-slate-500">How important is selling stock quickly?</span>
                        </div>
                         <div>
                            <label for="efficiency-weight" class="block text-sm font-medium text-slate-700">Storage Efficiency</p>
                            <input id="efficiency-weight" type="range" min="0" max="100" value="30" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" style="accent-color: #0ea5e9;">
                             <span class="text-xs text-slate-500">How important is profit per unit of storage space?</span>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6 md:p-8">
                     <h3 class="text-xl font-bold text-slate-900 mb-4">Top Ranked Commodities</h3>
                     <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-500">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Rank</th>
                                    <th scope="col" class="px-6 py-3">Commodity</th>
                                    <th scope="col" class="px-6 py-3">Overall Score</th>
                                    <th scope="col" class="px-6 py-3">Avg. Profit</th>
                                    <th scope="col" class="px-6 py-3">Avg. Holding (Days)</th>
                                    <th scope="col" class="px-6 py-3">Annual Turnover</th>
                                </tr>
                            </thead>
                            <tbody id="recommendations-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer class="mt-12 py-6 border-t border-slate-200">
        <div class="container mx-auto text-center text-sm text-slate-500">
            <p>&copy; 2025 Cold Storage Analytics. Data for simulation purposes only.</p>
        </div>
    </footer>


<script>
document.addEventListener('DOMContentLoaded', () => {

    const SIMULATED_DATA = {
        commodities: [
            { name: 'Tomato Big(Nepali)', minShelfLife: 7, avgPrice: 55.2, volatility: 0.45, unit: 'Kg' },
            { name: 'Potato Red', minShelfLife: 60, avgPrice: 35.8, volatility: 0.22, unit: 'Kg' },
            { name: 'Onion Dry (Indian)', minShelfLife: 30, avgPrice: 70.1, volatility: 0.35, unit: 'Kg' },
            { name: 'Carrot(Local)', minShelfLife: 150, avgPrice: 65.5, volatility: 0.28, unit: 'Kg' },
            { name: 'Fish Fresh', minShelfLife: 2, avgPrice: 280.0, volatility: 0.65, unit: 'Kg' },
            { name: 'Apple(Jholey)', minShelfLife: 90, avgPrice: 150.7, volatility: 0.18, unit: 'Kg' },
            { name: 'Gundruk', minShelfLife: 365, avgPrice: 250.0, volatility: 0.12, unit: 'Kg' },
            { name: 'Chilli Dry', minShelfLife: 180, avgPrice: 310.5, volatility: 0.31, unit: 'Kg' },
            { name: 'Cabbage(Local)', minShelfLife: 14, avgPrice: 40.3, volatility: 0.48, unit: 'Kg' },
            { name: 'Cauli Local', minShelfLife: 10, avgPrice: 60.9, volatility: 0.52, unit: 'Kg' },
            { name: 'Ginger', minShelfLife: 60, avgPrice: 120.0, volatility: 0.25, unit: 'Kg' },
            { name: 'Garlic Dry', minShelfLife: 120, avgPrice: 200.0, volatility: 0.29, unit: 'Kg' },
            { name: 'Mushroom(Kanya)', minShelfLife: 4, avgPrice: 180.0, volatility: 0.75, unit: 'Kg' },
            { name: 'Raddish White(Local)', minShelfLife: 7, avgPrice: 25.0, volatility: 0.55, unit: 'Kg' },
            { name: 'Banana', minShelfLife: 5, avgPrice: 85.0, volatility: 0.40, unit: 'Doz' },
        ],
        simulationResults: {
            'Tomato Big(Nepali)': { avgProfit: 5.1, avgHolding: 4, profitPerVolume: 5.1 },
            'Potato Red': { avgProfit: 8.5, avgHolding: 45, profitPerVolume: 9.5 },
            'Onion Dry (Indian)': { avgProfit: 12.3, avgHolding: 22, profitPerVolume: 14.8 },
            'Carrot(Local)': { avgProfit: 15.2, avgHolding: 95, profitPerVolume: 16.1 },
            'Fish Fresh': { avgProfit: 10.5, avgHolding: 1, profitPerVolume: 8.5 },
            'Apple(Jholey)': { avgProfit: 20.8, avgHolding: 70, profitPerVolume: 22.3 },
            'Gundruk': { avgProfit: 35.0, avgHolding: 150, profitPerVolume: 40.0 },
            'Chilli Dry': { avgProfit: 45.3, avgHolding: 110, profitPerVolume: 55.2 },
            'Cabbage(Local)': { avgProfit: 6.2, avgHolding: 8, profitPerVolume: 5.5 },
            'Cauli Local': { avgProfit: 7.8, avgHolding: 6, profitPerVolume: 7.1 },
            'Ginger': { avgProfit: 18.1, avgHolding: 40, profitPerVolume: 20.2 },
            'Garlic Dry': { avgProfit: 30.5, avgHolding: 85, profitPerVolume: 33.0 },
            'Mushroom(Kanya)': { avgProfit: 15.5, avgHolding: 2, profitPerVolume: 12.1 },
            'Raddish White(Local)': { avgProfit: 4.3, avgHolding: 5, profitPerVolume: 4.0 },
            'Banana': { avgProfit: 9.0, avgHolding: 3, profitPerVolume: 7.5 },
        },
        priceHistory: {}
    };

    function generatePriceHistory(basePrice, volatility, length = 100) {
        const history = [];
        let price = basePrice;
        for (let i = 0; i < length; i++) {
            const change = (Math.random() - 0.48) * volatility * price;
            price += change;
            price = Math.max(price, basePrice * 0.5); 
            history.push({
                x: new Date(2024, 0, 1 + i).toLocaleDateString(),
                y: price
            });
        }
        return history;
    }
    SIMULATED_DATA.commodities.forEach(c => {
        SIMULATED_DATA.priceHistory[c.name] = generatePriceHistory(c.avgPrice, c.volatility / 5, 100);
    });

    const chartInstances = {};

    function renderShelfLifeChart() {
        const categories = {
            'Short (< 15 days)': 0,
            'Medium (15-90 days)': 0,
            'Long (> 90 days)': 0
        };
        SIMULATED_DATA.commodities.forEach(c => {
            if (c.minShelfLife < 15) categories['Short (< 15 days)']++;
            else if (c.minShelfLife <= 90) categories['Medium (15-90 days)']++;
            else categories['Long (> 90 days)']++;
        });

        const ctx = document.getElementById('shelfLifeChart').getContext('2d');
        if(chartInstances.shelfLife) chartInstances.shelfLife.destroy();
        chartInstances.shelfLife = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(categories),
                datasets: [{
                    label: 'Number of Commodities',
                    data: Object.values(categories),
                    backgroundColor: ['#f59e0b', '#84cc16', '#0ea5e9'],
                    borderColor: '#ffffff',
                    borderWidth: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed;
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    function renderVolatilityChart() {
        const data = {
            datasets: [{
                label: 'Commodities',
                data: SIMULATED_DATA.commodities.map(c => ({
                    x: c.minShelfLife,
                    y: c.volatility,
                    name: c.name
                })),
                backgroundColor: 'rgba(132, 204, 22, 0.6)',
                borderColor: 'rgba(132, 204, 22, 1)',
                pointRadius: 6,
                pointHoverRadius: 9,
            }]
        };

        const ctx = document.getElementById('volatilityChart').getContext('2d');
        if(chartInstances.volatility) chartInstances.volatility.destroy();
        chartInstances.volatility = new Chart(ctx, {
            type: 'scatter',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: {
                            display: true,
                            text: 'Minimum Shelf Life (Days)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Annualized Volatility'
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.raw.name;
                            }
                        }
                    }
                },
                onClick: (evt, elements) => {
                    if (elements.length > 0) {
                        const commodityName = elements[0].element.$context.raw.name;
                        highlightCommodity(commodityName);
                    }
                }
            }
        });
    }

    let currentCommodityTable = [...SIMULATED_DATA.commodities];
    let sortConfig = { key: 'name', dir: 'asc' };
    
    function renderCommodityTable() {
        const tbody = document.getElementById('commodity-table-body');
        const filterText = document.getElementById('commodity-filter').value.toLowerCase();
        
        const sortedData = [...currentCommodityTable].sort((a, b) => {
            if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.dir === 'asc' ? -1 : 1;
            if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.dir === 'asc' ? 1 : -1;
            return 0;
        });

        const filteredData = sortedData.filter(c => c.name.toLowerCase().includes(filterText));

        tbody.innerHTML = filteredData.map(c => `
            <tr id="row-${c.name.replace(/\s|\(|\)/g, '-')}" class="bg-white border-b hover:bg-slate-50 cursor-pointer" onclick="highlightCommodity('${c.name}')">
                <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${c.name}</td>
                <td class="px-6 py-4">${c.minShelfLife}</td>
                <td class="px-6 py-4">${c.avgPrice.toFixed(2)}</td>
                <td class="px-6 py-4">${c.volatility.toFixed(2)}</td>
                <td class="px-6 py-4">${c.unit}</td>
            </tr>
        `).join('');

        updateSortHeaders();
    }
    
    function updateSortHeaders() {
        document.querySelectorAll('.table-sortable th').forEach(th => {
            th.classList.remove('sorted-asc', 'sorted-desc');
            if (th.dataset.sort === sortConfig.key) {
                th.classList.add(sortConfig.dir === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }
        });
    }

    document.querySelector('.table-sortable thead').addEventListener('click', e => {
        const key = e.target.dataset.sort;
        if (!key) return;
        if (sortConfig.key === key) {
            sortConfig.dir = sortConfig.dir === 'asc' ? 'desc' : 'asc';
        } else {
            sortConfig.key = key;
            sortConfig.dir = 'asc';
        }
        renderCommodityTable();
    });
    
    document.getElementById('commodity-filter').addEventListener('input', renderCommodityTable);


    function renderPriceHistoryChart(commodityName) {
        const historyData = SIMULATED_DATA.priceHistory[commodityName];
        if (!historyData) return;

        const ctx = document.getElementById('priceHistoryChart').getContext('2d');
        if(chartInstances.priceHistory) chartInstances.priceHistory.destroy();

        document.getElementById('price-chart-commodity-name').textContent = commodityName;

        chartInstances.priceHistory = new Chart(ctx, {
            type: 'line',
            data: {
                labels: historyData.map(d => d.x),
                datasets: [{
                    label: 'Average Price',
                    data: historyData.map(d => d.y),
                    borderColor: '#84cc16',
                    backgroundColor: 'rgba(132, 204, 22, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: { display: true, text: 'Price (NPR)' }
                    },
                    x: {
                        ticks: { display: false }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    let lastHighlightedRow = null;
    window.highlightCommodity = (commodityName) => {
        renderPriceHistoryChart(commodityName);
        if(lastHighlightedRow) lastHighlightedRow.classList.remove('bg-lime-100');
        const row = document.getElementById(`row-${commodityName.replace(/\s|\(|\)/g, '-')}`);
        if(row) {
            row.classList.add('bg-lime-100');
            lastHighlightedRow = row;
            row.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }


    function calculateRecommendations() {
        const profitWeight = parseFloat(document.getElementById('profit-weight').value);
        const turnoverWeight = parseFloat(document.getElementById('turnover-weight').value);
        const efficiencyWeight = parseFloat(document.getElementById('efficiency-weight').value);
        
        const totalWeight = profitWeight + turnoverWeight + efficiencyWeight;
        if(totalWeight === 0) {
            renderRecommendations([]);
            return;
        }

        const normalizedWeights = {
            profit: profitWeight / totalWeight,
            turnover: turnoverWeight / totalWeight,
            efficiency: efficiencyWeight / totalWeight
        };

        const results = SIMULATED_DATA.commodities.map(c => {
            const sim = SIMULATED_DATA.simulationResults[c.name];
            return {
                name: c.name,
                avgProfit: sim.avgProfit,
                avgHolding: sim.avgHolding,
                turnover: sim.avgHolding > 0 ? (365 / sim.avgHolding).toFixed(1) : '‚àû',
                profitPerVolume: sim.profitPerVolume,
            };
        });

        const maxProfit = Math.max(...results.map(r => r.avgProfit));
        const maxHolding = Math.max(...results.map(r => r.avgHolding));
        const maxEfficiency = Math.max(...results.map(r => r.profitPerVolume));

        const scoredResults = results.map(r => {
            const profitScore = (r.avgProfit / maxProfit) * 100;
            const turnoverScore = (1 - (r.avgHolding / maxHolding)) * 100;
            const efficiencyScore = (r.profitPerVolume / maxEfficiency) * 100;

            const totalScore = (profitScore * normalizedWeights.profit) +
                               (turnoverScore * normalizedWeights.turnover) +
                               (efficiencyScore * normalizedWeights.efficiency);
            return { ...r, totalScore };
        });

        scoredResults.sort((a, b) => b.totalScore - a.totalScore);
        renderRecommendations(scoredResults);
        
        if(scoredResults.length > 0) {
            document.getElementById('top-profitable').textContent = [...results].sort((a,b) => b.avgProfit - a.avgProfit)[0].name;
            document.getElementById('top-turnover').textContent = [...results].sort((a,b) => a.avgHolding - b.avgHolding)[0].name;
            document.getElementById('top-efficiency').textContent = [...results].sort((a,b) => b.profitPerVolume - a.profitPerVolume)[0].name;
        }
    }

    function renderRecommendations(rankedList) {
        const tbody = document.getElementById('recommendations-table-body');
        tbody.innerHTML = rankedList.map((r, index) => `
            <tr class="bg-white border-b">
                <td class="px-6 py-4 font-bold text-slate-800">${index + 1}</td>
                <td class="px-6 py-4 font-medium text-lime-700 whitespace-nowrap">${r.name}</td>
                <td class="px-6 py-4 font-semibold">${r.totalScore.toFixed(1)}</td>
                <td class="px-6 py-4 text-green-600">${r.avgProfit.toFixed(2)}</td>
                <td class="px-6 py-4 text-amber-600">${r.avgHolding}</td>
                <td class="px-6 py-4 text-sky-600">${r.turnover}</td>
            </tr>
        `).join('');
    }

    document.getElementById('profit-weight').addEventListener('input', calculateRecommendations);
    document.getElementById('turnover-weight').addEventListener('input', calculateRecommendations);
    document.getElementById('efficiency-weight').addEventListener('input', calculateRecommendations);


    function setupNavLinks() {
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                    });
                }
                entry.target.classList.toggle('visible', entry.isIntersecting);
            });
        }, { rootMargin: '-50% 0px -50% 0px', threshold: 0 });
        
        sections.forEach(section => observer.observe(section));
    }
    
    function init() {
        renderShelfLifeChart();
        renderVolatilityChart();
        renderCommodityTable();
        calculateRecommendations();
        renderPriceHistoryChart(SIMULATED_DATA.commodities[0].name);
        highlightCommodity(SIMULATED_DATA.commodities[0].name);
        setupNavLinks();
    }

    init();
});
</script>
</body>
</html>